# 🚀 Prediction Markets Strapi CMS

A Strapi CMS instance for managing prediction markets generated by the news pipeline.

## 🏗️ Features

- **Prediction Market Content Type**: Pre-configured with all necessary fields
- **API Ready**: REST API endpoints for CRUD operations
- **Render Deployment**: Configured for one-click deployment on Render
- **JWT Security**: Properly configured authentication
- **SQLite Database**: Lightweight database for free tier deployment

## 📊 Content Type: Prediction Market

### Fields:
- `title` (String, Required) - Market question
- `description` (Rich Text, Required) - Detailed market description
- `category` (Enum, Required) - One of 11 categories
- `tags` (JSON, Required) - Array of relevant tags
- `status` (Enum, Required) - open/closed/resolved
- `endTime` (DateTime, Required) - Market end time
- `resolutionTime` (DateTime, Required) - Resolution deadline
- `result` (Boolean, Optional) - Final result (true/false)
- `yesCount` (Integer, Required) - Yes votes count
- `noCount` (Integer, Required) - No votes count
- `totalVolume` (Integer, Required) - Total trading volume
- `currentYesProbability` (Decimal, Required) - Current yes probability
- `currentNoProbability` (Decimal, Required) - Current no probability
- `creatorId` (String, Required) - Market creator ID
- `resolutionSource` (String, Required) - Source URL for resolution
- `marketId` (String, Required, Unique) - Unique market identifier

## 🚀 Deployment on Render

### Option 1: One-Click Deploy
[![Deploy to Render](https://render.com/images/deploy-to-render-button.svg)](https://render.com/deploy)

### Option 2: Manual Deploy
1. Fork this repository
2. Go to [Render Dashboard](https://dashboard.render.com/)
3. Click "New +" → "Web Service"
4. Connect your forked repository
5. Use these settings:
   - **Build Command**: `npm install && npm run build`
   - **Start Command**: `npm start`
   - **Environment**: Node.js
   - **Plan**: Free

### Environment Variables (Auto-configured)
- `JWT_SECRET` - Auto-generated
- `ADMIN_JWT_SECRET` - Auto-generated
- `APP_KEYS` - Auto-generated
- `API_TOKEN_SALT` - Auto-generated
- `TRANSFER_TOKEN_SALT` - Auto-generated

## 🔧 Local Development

```bash
# Install dependencies
npm install

# Start development server
npm run develop

# Build for production
npm run build

# Start production server
npm start
```

## 📡 API Endpoints

Once deployed, your API will be available at:

```
GET    /api/prediction-markets          # Get all markets
GET    /api/prediction-markets/:id      # Get specific market
POST   /api/prediction-markets          # Create new market
PUT    /api/prediction-markets/:id      # Update market
DELETE /api/prediction-markets/:id      # Delete market
```

## 🔑 API Authentication

### Creating API Token
1. Access admin panel: `https://your-app.onrender.com/admin`
2. Go to Settings → API Tokens
3. Create new token with full access
4. Use token in Authorization header: `Bearer YOUR_TOKEN`

### Setting Permissions
1. Go to Settings → Users & Permissions → Roles → Public
2. Enable permissions for `prediction-market`:
   - ✅ find
   - ✅ findOne
   - ✅ create
   - ✅ update

## 🧪 Testing the API

```bash
# Get all markets
curl https://your-app.onrender.com/api/prediction-markets

# Create a new market
curl -X POST https://your-app.onrender.com/api/prediction-markets \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -d '{
    "data": {
      "title": "Will Bitcoin reach $100k by 2025?",
      "description": "Market about Bitcoin price prediction",
      "category": "Crypto",
      "tags": ["Bitcoin", "Cryptocurrency"],
      "status": "open",
      "endTime": "2025-12-31T23:59:59.000Z",
      "resolutionTime": "2025-12-31T23:59:59.000Z",
      "yesCount": 50000,
      "noCount": 50000,
      "totalVolume": 100000,
      "currentYesProbability": 0.5,
      "currentNoProbability": 0.5,
      "creatorId": "kalshi-generator",
      "resolutionSource": "https://example.com",
      "marketId": "btc_100k_2025"
    }
  }'
```

## 🔗 Integration with News Pipeline

This Strapi instance is designed to work with the news pipeline that:
1. Fetches articles from RSS feeds
2. Processes them with AI to generate prediction markets
3. Pushes the markets to this Strapi CMS via API

## 📋 Categories Supported

- Trending
- Politics
- Economy
- Crypto
- Tech
- World
- Culture
- Sports
- Education
- Business
- Environment

## 🛠️ Troubleshooting

### Common Issues:
- **JWT Error**: Environment variables are properly configured with defaults
- **Database Error**: Using SQLite for simplicity and free tier compatibility
- **Build Error**: All dependencies are pinned to stable versions
- **Permission Error**: Check API token and public role permissions

### Logs:
Check Render service logs for detailed error information.

## 📞 Support

If you encounter issues:
1. Check Render service logs
2. Verify environment variables
3. Test API endpoints manually
4. Check admin panel accessibility

## 🎯 Success Indicators

- ✅ Service deploys without errors
- ✅ Admin panel accessible
- ✅ API endpoints respond correctly
- ✅ Can create/read prediction markets
- ✅ News pipeline can push markets successfully
